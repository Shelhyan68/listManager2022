{% extends "base.html.twig" %}

{% block body %} 
    <div class="container d-flex flex-wrap">
        {% for list in lists %}
            <div class="card m-2" style="width: 18rem;">
                <div class="card-body">

                    
                        <h5 class="card-title" style="color: {{ list.color }}">{{ list.name }}</h5><br>
                        
                            {% for task in list.tasks %}
                            <p class="card-text">
                               {# <input type="checkbox" {{ task.completed ? "checked" : ""}} onchange="window.location.href='/update-task-status/{{task.id}}'"> #}
                               <a href="/update-task-status/{{task.id}}" class="js-status">

                            {% if task.completed %}
                                
                                <i class="fas fa-square"></i>

                            {% else %}
                                 
                                <i class="far fa-square"></i>

                            {% endif %}
                               
                               </a>

                                {{task.title}}
                                <a href="/update-task/{{ task.id }}" class="text-warning"><i class="fas fa-edit"></i></a>
                                <a href="/delete-task/{{ task.id }}" class="text-danger"><i class="fas fa-trash"></i></a>
                            </p>
                                {% endfor %}

                    <center>
                        <a href="/create-task/{{ list.id }}" class="btn btn-success"><i class="fas fa-plus"></i></a>
                    </center>
                    </p>

                    <a href="/update-list/{{ list.id }}" class="btn btn-warning"><i class="fas fa-edit"></i></a>
                    <a href="/delete-list/{{ list.id }}" class="btn btn-danger"><i class="fas fa-trash"></i></a>
                </div>
            </div>
        {% endfor %}
    </div>
{% endblock %}

{% block javascripts %}
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
        window.addEventListener("load", event => {
            document.querySelectorAll("a.js-status").forEach(link => {
                link.addEventListener("click", updateStatus);
            });
        });

    function updateStatus(event ){
        event.preventDefault();

        const checkIcon = this.querySelector("i.fa-square");

        axios.post(this.href).then(response => {
            if(checkIcon.classList.contains("fas")) {
                checkIcon.classList.replace("fas", "far");
            }
            else {
                checkIcon.classList.replace("far", "fas");
            }
        }).catch(error => {
            console.error(error);
            window.alert("Une erreur est survenue");
        });
    }
    
    </script>
{% endblock %}

